<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Planting Timeline</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .bg-app-dark { background-color: #121212; }
        .bg-card { background-color: #1e1e1e; }
        .color-start { background-color: #ff2d55; } /* Pink */
        .color-transplant { background-color: #ff9500; } /* Orange */
        .color-sow { background-color: #af52de; } /* Purple */
        .color-frost { background-color: rgba(59, 130, 246, 0.15); } /* Frost Blue Tint */
        
        .month-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            height: 100%;
            position: absolute;
            width: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .grid-line { border-right: 1px solid #333; }
    </style>
</head>
<body class="bg-app-dark text-gray-200 font-sans p-6">

    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-green-500">Garden Timeline</h1>
            <a href="index.html" class="text-sm bg-gray-800 hover:bg-gray-700 px-4 py-2 rounded-lg transition border border-gray-700 text-gray-300">‚Üê Back to Dashboard</a>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 text-[10px] font-semibold bg-black/30 p-4 rounded-xl border border-gray-800">
            <div class="flex items-center gap-2"><span class="w-6 h-2 rounded-full color-start"></span> Start Inside</div>
            <div class="flex items-center gap-2"><span class="w-6 h-2 rounded-full color-transplant"></span> Transplant</div>
            <div class="flex items-center gap-2"><span class="w-6 h-2 rounded-full color-sow"></span> Sow Outside</div>
            <div class="flex items-center gap-2"><span class="w-6 h-4 border border-blue-500/30 color-frost"></span> Frost Risk</div>
        </div>

        <div id="timeline-container" class="space-y-4">
            </div>

        <div id="empty-state" class="hidden text-center py-20">
            <p class="text-gray-500">No seeds found in your collection.</p>
            <a href="index.html" class="text-green-500 underline mt-2 block">Go add some seeds!</a>
        </div>
    </div>

    <script>
        // 1. Data Logic with Succession Intervals (in weeks)
        const plantLogic = {
            "Tomatoes": { sow: -6, plant: 2, maturity: 80, emoji: "üçÖ", succession: 0 },
            "Peppers": { sow: -8, plant: 3, maturity: 90, emoji: "ü´ë", succession: 0 },
            "Carrots": { sow: 0, plant: 0, maturity: 75, emoji: "ü•ï", succession: 3 },
            "Lettuce": { sow: -3, plant: -1, maturity: 45, emoji: "ü•¨", succession: 2 },
            "Kale": { sow: -4, plant: -2, maturity: 55, emoji: "ü•¨", succession: 4 },
            "Basil": { sow: -6, plant: 2, maturity: 60, emoji: "üåø", succession: 4 },
            "Bok Choy": { sow: -4, plant: 0, maturity: 45, emoji: "ü•¨", succession: 2 },
            "Broccoli": { sow: -7, plant: -2, maturity: 70, emoji: "ü•¶", succession: 0 }
        };

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            const seeds = JSON.parse(localStorage.getItem('mySeeds')) || [];
            const frostDateStr = localStorage.getItem('frostDate');
            
            if (seeds.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                return;
            }

            // Defaulting to May 15 if no frost date is set (typical for Hartford)
            const lastFrost = new Date(frostDateStr || '2026-05-15');
            const currentYear = lastFrost.getFullYear();

            // Calculate Frost Danger Zone (Roughly Nov to April)
            // Position for May 15 and Oct 15
            const springFrostEnd = (new Date(currentYear, 4, 15) - new Date(currentYear, 0, 1)) / (1000 * 60 * 60 * 24 * 365) * 100;
            const fallFrostStart = (new Date(currentYear, 9, 15) - new Date(currentYear, 0, 1)) / (1000 * 60 * 60 * 24 * 365) * 100;

            container.innerHTML = seeds.map(seed => {
                const info = plantLogic[seed.name] || { sow: -4, plant: 2, maturity: 65, emoji: "üå±", succession: 0 };
                
                const getPos = (date) => {
                    const startOfYear = new Date(currentYear, 0, 1);
                    const diff = date - startOfYear;
                    return Math.max(0, Math.min(100, (diff / (1000 * 60 * 60 * 24 * 365)) * 100));
                };

                // Generate Succession Batches
                const batches = info.succession > 0 ? 3 : 1;
                let barsHtml = '';

                for (let i = 0; i < batches; i++) {
                    let offsetDays = i * (info.succession * 7);
                    let sowDate = new Date(lastFrost); 
                    sowDate.setDate(lastFrost.getDate() + (info.sow * 7) + offsetDays);
                    let plantDate = new Date(lastFrost); 
                    plantDate.setDate(lastFrost.getDate() + (info.plant * 7) + offsetDays);
                    
                    let sowPos = getPos(sowDate);
                    let plantPos = getPos(plantDate);
                    let opacity = 1 - (i * 0.3); // Fade later batches

                    barsHtml += `
                        ${info.sow !== 0 ? `<div class="absolute h-2 rounded-full color-start" style="top: 15%; left: ${sowPos}%; width: 3%; opacity: ${opacity}; z-index: 5;"></div>` : ''}
                        <div class="absolute h-2 rounded-full color-transplant" style="top: 45%; left: ${plantPos}%; width: 4%; opacity: ${opacity}; z-index: 5;"></div>
                        <div class="absolute h-2 rounded-full color-sow" style="top: 75%; left: ${plantPos + 5}%; width: 8%; opacity: ${opacity}; z-index: 5;"></div>
                    `;
                }

                return `
                <div class="bg-card rounded-2xl p-4 flex items-center gap-6 shadow-xl border border-gray-800 hover:border-gray-600 transition">
                    <div class="w-20 flex flex-col items-center shrink-0">
                        <span class="text-3xl">${info.emoji}</span>
                        <span class="text-[10px] mt-1 font-bold uppercase tracking-wider text-gray-400">${seed.name}</span>
                        ${info.succession > 0 ? `<span class="text-[8px] text-blue-400 font-bold mt-1">BATCHED</span>` : ''}
                    </div>
                    
                    <div class="flex-1 relative">
                        <div class="grid grid-cols-12 text-[10px] mb-2 text-gray-500 font-medium">
                            <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span>
                            <span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
                        </div>
                        
                        <div class="h-16 relative bg-[#181818] rounded-lg overflow-hidden border border-gray-800/50">
                            <div class="absolute top-0 bottom-0 color-frost left-0" style="width: ${springFrostEnd}%;"></div>
                            <div class="absolute top-0 bottom-0 color-frost" style="left: ${fallFrostStart}%; right: 0;"></div>

                            <div class="month-grid">
                                ${Array(12).fill('<div class="grid-line"></div>').join('')}
                            </div>

                            <div class="today-marker absolute top-0 bottom-0 w-[2px] bg-white z-20 shadow-[0_0_8px_white]"></div>

                            ${barsHtml}
                        </div>
                    </div>
                </div>`;
            }).join('');

            updateTodayLine();
        }

        function updateTodayLine() {
            const now = new Date();
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const diff = now - startOfYear;
            const percentage = (diff / (1000 * 60 * 60 * 24 * 365)) * 100;
            
            document.querySelectorAll('.today-marker').forEach(line => {
                line.style.left = percentage + '%';
            });
        }

        renderTimeline();
    </script>
</body>
</html>
