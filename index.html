<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GardenHub OS | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f8fafc; color: #334155; font-family: 'Inter', sans-serif; }
        .glass-panel { background: white; border: 1px solid #e2e8f0; border-radius: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        
        /* Sun Map Colors */
        .sun-cell { transition: all 0.2s ease; cursor: pointer; border: 1px solid #f1f5f9; height: 30px; border-radius: 6px; }
        .sun-full { background: #fef3c7; border-color: #fcd34d; }
        .sun-partial { background: #ede9fe; border-color: #ddd6fe; }
        .sun-shade { background: #f1f5f9; border-color: #e2e8f0; }

        .seed-card { background: white; border: 1px solid #e2e8f0; transition: all 0.3s ease; cursor: pointer; }
        .seed-card.companion-friend { border: 2px solid #22c55e; background: #f0fdf4; }
        .seed-card.companion-foe { opacity: 0.2; filter: grayscale(1); }
        .seed-card.dimmed { opacity: 0.4; }

        .health-ring { border-radius: 50%; width: 10px; height: 10px; display: inline-block; }
        .health-good { background: #22c55e; }
        .health-danger { background: #ef4444; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* Forecast Progress Bar */
        .progress-bg { background: #f1f5f9; border-radius: 10px; height: 6px; width: 100%; overflow: hidden; }
        .progress-fill { background: #3b82f6; height: 100%; transition: width 0.5s ease; }
        .harvest-fill { background: #22c55e; }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-6xl mx-auto">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
        <div>
            <h1 class="text-4xl font-black text-slate-800 tracking-tighter">GardenHub <span class="text-green-600">OS</span></h1>
            <p id="live-date" class="text-slate-500 font-medium text-sm mt-1 uppercase tracking-widest italic">Hartford, CT</p>
        </div>
        <nav class="flex flex-wrap gap-2">
            <a href="calendar.html" class="bg-white hover:bg-slate-50 px-4 py-2 rounded-xl text-xs font-bold transition border border-slate-200 shadow-sm text-slate-600">üìÖ Timeline</a>
            <a href="map.html" class="bg-white hover:bg-slate-50 px-4 py-2 rounded-xl text-xs font-bold transition border border-slate-200 shadow-sm text-slate-600">üó∫Ô∏è Garden Map</a>
            <a href="logs.html" class="bg-white hover:bg-slate-50 px-4 py-2 rounded-xl text-xs font-bold transition border border-slate-200 shadow-sm text-slate-600">üìà ROI Logs</a>
            <button onclick="resetMatchmaker()" class="bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-xl text-xs font-bold transition text-white shadow-lg">üîÑ Reset View</button>
        </nav>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-10">
        <div class="lg:col-span-1 grid grid-cols-2 gap-4">
            <div class="glass-panel p-4 text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase">Crops</p>
                <h3 id="stat-planted" class="text-2xl font-black text-slate-800">0</h3>
            </div>
            <div class="glass-panel p-4 text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase">Tasks</p>
                <h3 id="stat-tasks" class="text-2xl font-black text-orange-500">0</h3>
            </div>
            <div class="glass-panel p-4 text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase">Temp</p>
                <h3 class="text-2xl font-black text-blue-500">42¬∞F</h3>
            </div>
            <div class="glass-panel p-4 text-center">
                <p class="text-[9px] font-bold text-slate-400 uppercase">Yield</p>
                <h3 id="stat-harvest-val" class="text-2xl font-black text-green-600">$0</h3>
            </div>
        </div>

        <div class="lg:col-span-3 glass-panel p-5">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-xs font-bold uppercase tracking-widest text-slate-400">Spatial Sun Map</h3>
                <div class="flex gap-3 text-[8px] font-bold uppercase">
                    <span class="flex items-center gap-1"><div class="w-2 h-2 sun-full rounded-sm"></div> Full</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 sun-partial rounded-sm"></div> Partial</span>
                    <span class="flex items-center gap-1"><div class="w-2 h-2 sun-shade rounded-sm"></div> Shade</span>
                </div>
            </div>
            <div id="sun-map" class="grid grid-cols-8 gap-1"></div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 space-y-8">
            <div>
                <h2 class="text-xl font-bold text-slate-800 mb-6">Crop Command</h2>
                <div id="seed-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
            
            <div class="glass-panel p-6">
                <h2 class="text-lg font-bold mb-4">Harvest Forecast</h2>
                <div id="harvest-forecast" class="space-y-4">
                    </div>
            </div>
        </div>

        <div class="space-y-6">
            <div class="glass-panel p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    <span class="text-blue-500">üå°Ô∏è</span> Vitals & Outlook
                </h2>
                <div class="min-h-[150px]">
                    <a class="weatherwidget-io" href="https://forecast7.com/en/41_76n72_67/hartford/" data-label_1="ZONE 6B" data-label_2="HARTFORD" data-theme="pure" data-basecolor="#ffffff" data-textcolor="#334155" data-highcolor="#ef4444" data-lowcolor="#3b82f6" data-days="7">WEATHER</a>
                </div>
                <div class="mt-6 pt-4 border-t border-slate-100">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Soil Moisture</p>
                        <span class="text-[10px] font-bold text-blue-500">65%</span>
                    </div>
                    <div class="progress-bg"><div class="progress-fill" style="width: 65%;"></div></div>
                </div>
            </div>

            <div class="glass-panel p-6">
                <h2 class="text-lg font-bold mb-4">Urgent Actions</h2>
                <div id="taskList" class="space-y-3 mb-4"></div>
                <div class="flex gap-2">
                    <input type="text" id="taskDesc" placeholder="Quick task..." class="bg-slate-100 border-none text-sm p-3 rounded-xl flex-1 focus:ring-2 focus:ring-green-500 transition-all">
                    <button onclick="addTask()" class="bg-green-600 hover:bg-green-700 text-white px-4 rounded-xl font-bold text-xs uppercase transition-colors">Add</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const plantLogic = {
        "Tomatoes": { emoji: "üçÖ", sensitivity: 45, daysToHarvest: 80, friends: ["Basil", "Carrots"], foes: ["Broccoli", "Kale"] },
        "Peppers": { emoji: "ü´ë", sensitivity: 50, daysToHarvest: 75, friends: ["Basil", "Bok Choy"], foes: ["Kale"] },
        "Carrots": { emoji: "ü•ï", sensitivity: 28, daysToHarvest: 70, friends: ["Tomatoes", "Lettuce"], foes: ["None"] },
        "Lettuce": { emoji: "ü•¨", sensitivity: 32, daysToHarvest: 45, friends: ["Carrots", "Bok Choy"], foes: ["Broccoli"] },
        "Kale": { emoji: "üåø", sensitivity: 20, daysToHarvest: 60, friends: ["Lettuce"], foes: ["Tomatoes", "Peppers"] },
        "Basil": { emoji: "üå±", sensitivity: 55, daysToHarvest: 30, friends: ["Tomatoes", "Peppers"], foes: ["None"] },
        "Cosmos": { emoji: "üå∏", sensitivity: 35, daysToHarvest: 60, friends: ["Coneflower"], foes: ["None"] },
        "Coneflower": { emoji: "üåª", sensitivity: 30, daysToHarvest: 90, friends: ["Cosmos"], foes: ["None"] },
        "Shasta Daisy": { emoji: "üåº", sensitivity: 30, daysToHarvest: 85, friends: ["None"], foes: ["None"] }
    };

    let sunData = JSON.parse(localStorage.getItem('gardenSunMap')) || Array(32).fill('full');

    function initSunMap() {
        const map = document.getElementById('sun-map');
        if (!map) return;
        map.innerHTML = '';
        sunData.forEach((state, i) => {
            const cell = document.createElement('div');
            cell.className = `sun-cell sun-${state}`;
            cell.onclick = () => {
                const states = ['full', 'partial', 'shade'];
                sunData[i] = states[(states.indexOf(sunData[i]) + 1) % 3];
                localStorage.setItem('gardenSunMap', JSON.stringify(sunData));
                initSunMap();
            };
            map.appendChild(cell);
        });
    }

    function renderSeedGrid() {
        const seeds = JSON.parse(localStorage.getItem('mySeeds')) || [{name: "Cosmos"}, {name: "Coneflower"}, {name: "Shasta Daisy"}];
        const grid = document.getElementById('seed-grid');
        if (!grid) return;
        
        grid.innerHTML = seeds.map(seed => {
            const info = plantLogic[seed.name] || { emoji: "üå±", sensitivity: 32, friends: [], foes: [] };
            const isAtRisk = 42 <= info.sensitivity;
            return `
                <div id="card-${seed.name}" onclick="handleMatchmaker('${seed.name}')" class="seed-card p-6 rounded-3xl relative">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-4xl">${info.emoji}</span>
                        <div class="health-ring ${isAtRisk ? 'health-danger' : 'health-good'}"></div>
                    </div>
                    <h4 class="text-slate-800 font-black text-xl uppercase tracking-tighter">${seed.name}</h4>
                    ${isAtRisk ? `<p class="text-[9px] text-red-500 font-bold mt-2 uppercase tracking-widest">‚ö†Ô∏è Protect Crop</p>` : ''}
                </div>
            `;
        }).join('');
        document.getElementById('stat-planted').innerText = seeds.length;
        updateGlobalStats();
        renderForecast(seeds);
    }

    function renderForecast(seeds) {
        const forecastEl = document.getElementById('harvest-forecast');
        if (!forecastEl) return;
        
        forecastEl.innerHTML = seeds.map(seed => {
            const info = plantLogic[seed.name] || { emoji: "üå±", daysToHarvest: 50 };
            const progress = Math.floor(Math.random() * 60) + 20; // Simulated progress
            return `
                <div class="flex items-center gap-4">
                    <span class="text-2xl">${info.emoji}</span>
                    <div class="flex-1">
                        <div class="flex justify-between text-[10px] font-bold uppercase text-slate-400 mb-1">
                            <span>${seed.name}</span>
                            <span>${Math.round(info.daysToHarvest * (1 - progress/100))} Days to Maturity</span>
                        </div>
                        <div class="progress-bg"><div class="progress-fill harvest-fill" style="width: ${progress}%"></div></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function updateGlobalStats() {
        const logs = JSON.parse(localStorage.getItem('harvestLogs')) || [];
        const total = logs.reduce((acc, log) => acc + log.value, 0);
        document.getElementById('stat-harvest-val').innerText = `$${Math.round(total)}`;
    }

    function handleMatchmaker(activeName) {
        const info = plantLogic[activeName];
        if (!info) return;
        document.querySelectorAll('.seed-card').forEach(card => {
            const cardName = card.id.replace('card-', '');
            card.classList.remove('companion-friend', 'companion-foe', 'dimmed');
            if (cardName === activeName) return;
            if (info.friends?.includes(cardName)) card.classList.add('companion-friend');
            else if (info.foes?.includes(cardName)) card.classList.add('companion-foe');
            else card.classList.add('dimmed');
        });
    }

    function resetMatchmaker() {
        document.querySelectorAll('.seed-card').forEach(c => c.classList.remove('companion-friend', 'companion-foe', 'dimmed'));
    }

    function addTask() {
        const desc = document.getElementById('taskDesc').value;
        if (!desc) return;
        let tasks = JSON.parse(localStorage.getItem('gardenTasks')) || [];
        tasks.push({ id: Date.now(), desc });
        localStorage.setItem('gardenTasks', JSON.stringify(tasks));
        document.getElementById('taskDesc').value = "";
        renderTasks();
    }

    function renderTasks() {
        const tasks = JSON.parse(localStorage.getItem('gardenTasks')) || [];
        const taskList = document.getElementById('taskList');
        if (!taskList) return;
        taskList.innerHTML = tasks.map(t => `
            <div class="flex items-center gap-3 bg-slate-50 p-4 rounded-2xl border border-slate-100">
                <input type="checkbox" onchange="removeTask(${t.id})" class="w-4 h-4 rounded-full border-slate-300 text-green-600 focus:ring-green-500">
                <span class="text-xs font-semibold text-slate-600 flex-1">${t.desc}</span>
            </div>
        `).reverse().join('');
        document.getElementById('stat-tasks').innerText = tasks.length;
    }

    function removeTask(id) {
        let tasks = JSON.parse(localStorage.getItem('gardenTasks')) || [];
        tasks = tasks.filter(t => t.id !== id);
        localStorage.setItem('gardenTasks', JSON.stringify(tasks));
        renderTasks();
    }

    window.onload = () => {
        document.getElementById('live-date').innerText = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        initSunMap();
        renderSeedGrid();
        renderTasks();
        
        // Force Weather Widget Re-init
        if (typeof __weatherwidget_init === 'function') {
            __weatherwidget_init();
        }
    };

    !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
</script>
</body>
</html>
